from flask import Flask, render_template, request, redirect, url_for, flash
from .scanner import scan_sql_injection, scan_xss

def create_app():
    app = Flask(__name__)

    @app.route('/')
    def index():
        return render_template('index.html')

    @app.route('/scan/<vulnerability_type>', methods=['GET', 'POST'])
    def scan(vulnerability_type):
        if request.method == 'POST':
            url = request.form.get('url')
            if vulnerability_type == 'sql':
                result = scan_sql_injection(url)
            elif vulnerability_type == 'xss':
                result = scan_xss(url)
            else:
                flash("Invalid scan type")
                return redirect(url_for('index'))
            return render_template('scan.html', result=result, vulnerability_type=vulnerability_type)
        return render_template('scan.html', vulnerability_type=vulnerability_type)

    return app
